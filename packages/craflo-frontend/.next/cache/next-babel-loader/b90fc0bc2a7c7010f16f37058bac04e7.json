{"ast":null,"code":"var _jsxFileName = \"/usr/local/src/app/packages/craflo-frontend/src/reaction/context/CartContext.tsx\";\nimport React from \"react\";\nvar __jsx = React.createElement;\n\nfunction ownKeys(object, enumerableOnly) { var keys = Object.keys(object); if (Object.getOwnPropertySymbols) { var symbols = Object.getOwnPropertySymbols(object); if (enumerableOnly) symbols = symbols.filter(function (sym) { return Object.getOwnPropertyDescriptor(object, sym).enumerable; }); keys.push.apply(keys, symbols); } return keys; }\n\nfunction _objectSpread(target) { for (var i = 1; i < arguments.length; i++) { var source = arguments[i] != null ? arguments[i] : {}; if (i % 2) { ownKeys(Object(source), true).forEach(function (key) { _defineProperty(target, key, source[key]); }); } else if (Object.getOwnPropertyDescriptors) { Object.defineProperties(target, Object.getOwnPropertyDescriptors(source)); } else { ownKeys(Object(source)).forEach(function (key) { Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key)); }); } } return target; }\n\nfunction _defineProperty(obj, key, value) { if (key in obj) { Object.defineProperty(obj, key, { value: value, enumerable: true, configurable: true, writable: true }); } else { obj[key] = value; } return obj; }\n\nimport { createContext, useState, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Cookies from \"js-cookie\";\nconst ANONYMOUS_CART_ID_KEY_NAME = \"_ANONYMOUS_CART_ID_\";\nconst ANONYMOUS_CART_TOKEN_KEY_NAME = \"_ANONYMOUS_CART_TOKEN_\";\nexport const CartContext = /*#__PURE__*/createContext({});\nexport const CartProvider = ({\n  children\n}) => {\n  const {\n    0: anonymousCartId,\n    1: setAnonymousCartId\n  } = useState({});\n  const {\n    0: anonymousCartToken,\n    1: setAnonymousCartToken\n  } = useState({});\n  const {\n    0: accountCartId,\n    1: setAccountCartId\n  } = useState({});\n  const {\n    0: isReconcilingCarts,\n    1: setIsReconcilingCarts\n  } = useState(false);\n  const {\n    0: checkoutPayments,\n    1: setCheckoutPayments\n  } = useState([]);\n\n  const setAnonymousCartCredentials = (newAnonymousCartId, newAnonymousCartToken, shopId) => {\n    console.log(newAnonymousCartId, newAnonymousCartToken, shopId);\n    setAnonymousCartId({\n      [shopId]: newAnonymousCartId || null\n    });\n    setAnonymousCartToken({\n      [shopId]: newAnonymousCartToken || null\n    });\n\n    if (typeof newAnonymousCartId === \"string\" && newAnonymousCartId.length) {\n      // Save to local storage\n      localStorage.setItem(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\")), {}, {\n        [shopId]: newAnonymousCartId\n      })));\n      localStorage.setItem(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\")), {}, {\n        [shopId]: newAnonymousCartToken\n      }))); // Save cookies\n\n      Cookies.set(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(Cookies.get(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\")), {}, {\n        [shopId]: newAnonymousCartId\n      })));\n      Cookies.set(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(Cookies.get(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\")), {}, {\n        [shopId]: newAnonymousCartToken\n      })));\n    } else {\n      // Remove from local storage\n      localStorage.setItem(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\")), {}, {\n        shopId\n      })));\n      localStorage.setItem(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\")), {}, {\n        shopId\n      }))); // Remove cookies\n\n      Cookies.set(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(Cookies.get(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\")), {}, {\n        shopId\n      })));\n      Cookies.set(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify(_objectSpread(_objectSpread({}, JSON.parse(Cookies.get(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\")), {}, {\n        shopId\n      })));\n    }\n  };\n\n  const clearAnonymousCartCredentials = shopId => {\n    setAnonymousCartCredentials(null, null, shopId);\n  };\n\n  const setAnonymousCartCredentialsFromLocalStorage = () => {\n    // const anonymousCartId = localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME + shopId); // eslint-disable-line no-shadow\n    // const anonymousCartToken = localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME + shopId); // eslint-disable-line no-shadow\n    const ids = JSON.parse(localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\");\n    const tokens = JSON.parse(localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\");\n\n    for (const shop in ids) {\n      console.log(shop, ids, \"uuuuu\");\n      setAnonymousCartCredentials(ids[shop], tokens[shop], shop);\n    }\n  };\n\n  useEffect(() => {\n    setAnonymousCartCredentialsFromLocalStorage();\n  }, []);\n\n  const addCheckoutPayment = value => {\n    setCheckoutPayments([...checkoutPayments, value]);\n  };\n\n  const setCheckoutPayment = value => {\n    setCheckoutPayments([value]);\n  };\n\n  const resetCheckoutPayments = () => {\n    setCheckoutPayments([]);\n  };\n\n  return /*#__PURE__*/React.createElement(CartContext.Provider, {\n    value: {\n      anonymousCartId,\n      anonymousCartToken,\n      accountCartId,\n      isReconcilingCarts,\n      checkoutPayments,\n      setAnonymousCartCredentials,\n      clearAnonymousCartCredentials,\n      setAnonymousCartCredentialsFromLocalStorage,\n      setIsReconcilingCarts,\n      hasAnonymousCartCredentials: shopId => anonymousCartId[shopId] && anonymousCartToken[shopId] || false,\n      hasAccountCart: shopId => typeof accountCartId[shopId] === \"string\",\n      setAccountCartId,\n      addCheckoutPayment,\n      setCheckoutPayment,\n      resetCheckoutPayments\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 80,\n      columnNumber: 5\n    }\n  }, children);\n};\nCartProvider.propTypes = {\n  children: PropTypes.node\n};","map":{"version":3,"sources":["/usr/local/src/app/packages/craflo-frontend/src/reaction/context/CartContext.tsx"],"names":["createContext","useState","useEffect","PropTypes","Cookies","ANONYMOUS_CART_ID_KEY_NAME","ANONYMOUS_CART_TOKEN_KEY_NAME","CartContext","CartProvider","children","anonymousCartId","setAnonymousCartId","anonymousCartToken","setAnonymousCartToken","accountCartId","setAccountCartId","isReconcilingCarts","setIsReconcilingCarts","checkoutPayments","setCheckoutPayments","setAnonymousCartCredentials","newAnonymousCartId","newAnonymousCartToken","shopId","console","log","length","localStorage","setItem","JSON","stringify","parse","getItem","set","get","clearAnonymousCartCredentials","setAnonymousCartCredentialsFromLocalStorage","ids","tokens","shop","addCheckoutPayment","value","setCheckoutPayment","resetCheckoutPayments","hasAnonymousCartCredentials","hasAccountCart","propTypes","node"],"mappings":"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","sourcesContent":["import { createContext, useState, useEffect } from \"react\";\nimport PropTypes from \"prop-types\";\nimport Cookies from \"js-cookie\";\n\nconst ANONYMOUS_CART_ID_KEY_NAME = \"_ANONYMOUS_CART_ID_\";\nconst ANONYMOUS_CART_TOKEN_KEY_NAME = \"_ANONYMOUS_CART_TOKEN_\";\n\nexport const CartContext = createContext({} as any);\n\nexport const CartProvider = ({ children }) => {\n  const [anonymousCartId, setAnonymousCartId] = useState({});\n  const [anonymousCartToken, setAnonymousCartToken] = useState({});\n  const [accountCartId, setAccountCartId] = useState({});\n  const [isReconcilingCarts, setIsReconcilingCarts] = useState(false);\n  const [checkoutPayments, setCheckoutPayments] = useState([]);\n\n  const setAnonymousCartCredentials = (newAnonymousCartId, newAnonymousCartToken,shopId) => {\n\n    console.log(newAnonymousCartId, newAnonymousCartToken, shopId)\n    setAnonymousCartId({\n      [shopId]: newAnonymousCartId || null\n    });\n    setAnonymousCartToken({\n      [shopId]: newAnonymousCartToken || null\n    });\n\n    if (typeof newAnonymousCartId === \"string\" && newAnonymousCartId.length) {\n      // Save to local storage\n      localStorage.setItem(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify({...JSON.parse(localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\"), [shopId]: newAnonymousCartId}));\n      localStorage.setItem(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify({...JSON.parse(localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\"), [shopId]: newAnonymousCartToken}));\n\n      // Save cookies\n      Cookies.set(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify({...JSON.parse(Cookies.get(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\"), [shopId]: newAnonymousCartId}));\n      Cookies.set(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify({...JSON.parse(Cookies.get(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\"), [shopId]: newAnonymousCartToken}));\n    } else {\n      // Remove from local storage\n      localStorage.setItem(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify({...JSON.parse(localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\"), shopId}));\n      localStorage.setItem(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify({...JSON.parse(localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\"), shopId}));\n\n      // Remove cookies\n      Cookies.set(ANONYMOUS_CART_ID_KEY_NAME, JSON.stringify({...JSON.parse(Cookies.get(ANONYMOUS_CART_ID_KEY_NAME)  || \"{}\"), shopId}));\n      Cookies.set(ANONYMOUS_CART_TOKEN_KEY_NAME, JSON.stringify({...JSON.parse(Cookies.get(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\"), shopId}));\n    }\n  };\n\n  const clearAnonymousCartCredentials = (shopId) => {\n    setAnonymousCartCredentials(null, null, shopId);\n  };\n\n  const setAnonymousCartCredentialsFromLocalStorage = () => {\n    // const anonymousCartId = localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME + shopId); // eslint-disable-line no-shadow\n    // const anonymousCartToken = localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME + shopId); // eslint-disable-line no-shadow\n    const ids = JSON.parse(localStorage.getItem(ANONYMOUS_CART_ID_KEY_NAME) || \"{}\")\n    const tokens = JSON.parse(localStorage.getItem(ANONYMOUS_CART_TOKEN_KEY_NAME) || \"{}\")\n\n    for(const shop in ids) {\n      console.log(shop, ids, \"uuuuu\")\n        setAnonymousCartCredentials(ids[shop], tokens[shop], shop);\n    }\n\n  };\n\n  useEffect(() => {\n    setAnonymousCartCredentialsFromLocalStorage();\n  }, []);\n\n  const addCheckoutPayment = (value) => {\n    setCheckoutPayments([...checkoutPayments, value]);\n  };\n\n  const setCheckoutPayment = (value) => {\n    setCheckoutPayments([value]);\n  };\n\n  const resetCheckoutPayments = () => {\n    setCheckoutPayments([]);\n  };\n\n  return (\n    <CartContext.Provider value={{\n      anonymousCartId,\n      anonymousCartToken,\n      accountCartId,\n      isReconcilingCarts,\n      checkoutPayments,\n      setAnonymousCartCredentials,\n      clearAnonymousCartCredentials,\n      setAnonymousCartCredentialsFromLocalStorage,\n      setIsReconcilingCarts,\n      hasAnonymousCartCredentials:  (shopId) =>  (anonymousCartId[shopId] && anonymousCartToken[shopId]) || false,\n      hasAccountCart: (shopId) => typeof accountCartId[shopId] === \"string\",\n      setAccountCartId,\n      addCheckoutPayment,\n      setCheckoutPayment,\n      resetCheckoutPayments\n    }}\n    >\n      {children}\n    </CartContext.Provider>\n  );\n};\n\nCartProvider.propTypes = {\n  children: PropTypes.node\n};\n"]},"metadata":{},"sourceType":"module"}